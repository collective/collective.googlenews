[buildout]
extends =
    https://raw.github.com/collective/buildout.plonetest/master/test-4.x.cfg
    https://raw.github.com/collective/buildout.plonetest/master/qa.cfg

package-name = collective.googlenews
package-extras = [test]
package-src = collective/googlenews
package-pep8-ignores = E501
package-coverage = 80
parts+=
    createzopecoverage
    coverage-sh
    flake8
    python-validation-sh
    rebuild-i18n-sh

[rebuild-i18n-sh]
recipe=collective.recipe.template
output = ${buildout:directory}/rebuild_i18n.sh
mode = 755
inline=
    #! /bin/sh
    
    I18NDOMAIN="${buildout:package-name}"
    BASE_DIRECTORY="${buildout:package-src}"
    
    # Synchronise the templates and scripts with the .pot.
    i18ndude rebuild-pot --pot $BASE_DIRECTORY/locales/$I18NDOMAIN.pot \
        --merge $BASE_DIRECTORY/locales/manual.pot \
        --create I18NDOMAIN \
        $BASE_DIRECTORY
    
    # Synchronise the resulting .pot with all .po files
    for po in $BASE_DIRECTORY/locales/*/LC_MESSAGES/$I18NDOMAIN.po; do
        i18ndude sync --pot $BASE_DIRECTORY/locales/$I18NDOMAIN.pot $po
    done
    
    # Report of errors and suspect untranslated messages
    i18ndude find-untranslated -n $BASE_DIRECTORY
